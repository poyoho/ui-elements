import{t as e,a as t,b as n}from"./resolvePackage.fdc5f42d.js";import{g as s}from"./shadow.87af85ed.js";import{d as i}from"./debounce.cf38708f.js";import{i as a}from"./index.7aeb2d8f.js";import"./vendor.3da8fb95.js";function l(e){return new CustomEvent("unpkg-change",{detail:e})}function o(e){const t=e.target,n=s(t),{panel:i}=n;i.classList.toggle("show"),c(n.installed,n.resultContent,!0)}function r(e){const t=e.target;if("LI"!==t.tagName||!t.hasAttribute("key"))return;const n=s(t);e.currentTarget.querySelector(".active").classList.toggle("active",!1),t.classList.toggle("active",!0),n.activeMenu=t.getAttribute("key"),function(e){const{keywordInput:t,resultContent:n,activeMenu:s}=e;switch(Array.from(n.children).forEach((e=>e.remove())),t.value="",s){case"Installed":c(e.installed,n,"Installed"===e.activeMenu)}}(n)}function c(e,t,n){const i=s(t),a=new Set(i.installed.map((e=>e.name)));t.innerHTML=e.reduce(((e,t)=>{const s=t.version,i=n?"uninstall":a.has(t.name)?"✔ installed":"install";return e.concat(['<div class="item">',`<a class="pkg-title" target="_blank" href="https://www.npmjs.com/package/${t.name}${s?"/v/"+s:""}">${t.name}${s?"@"+s:""}</a>`,`<div class="pkg-desc">${t.description}</div>`,`<div class="pkg-ctrl ${i}">`,'<select-box placeholder="pick package"></select-box>',`<button key="${i}" name="${t.name}">${i}</button>`,"</div></div>"])}),[]).join("\n")}async function d(){const e=s(this),t=e.keywordInput.value;switch(e.activeMenu){case"Packages":c(await n(t),e.resultContent,!1);break;case"Installed":{const n=new RegExp(`[${t}]{${t.length}}`);c(e.installed.filter((e=>n.test(e.name))),e.resultContent,!0);break}}}async function u(e){const n=e.target;if("BUTTON"===n.tagName)switch(n.innerHTML){case"install":{const e=n.getAttribute("name"),s=await t(e),i=Object.keys(s.versions),a=n.previousElementSibling;a.innerHTML=i.splice(i.length-13).sort().reverse().map((e=>`<option-box value="${e}">${e}</option-box>`)).join(""),a.style.display="inline-block",n.innerHTML='<button key="confirm">confirm</button>  <button key="cancel">cancel</button>';break}case"uninstall":{const e=s(n),t=n.getAttribute("name"),i=e.installed.findIndex((e=>e.name===t));if(-1!==i){const t=e.installed[i];e.installed.splice(i,1),c(e.installed,e.resultContent,!0),e.dispatchEvent(l({item:t,list:e.installed,action:"delete"}))}break}case"confirm":{const e=n.parentElement,t=e.previousElementSibling,i=t.value;if(!i){t.classList.toggle("input-error",!0),setTimeout((()=>{t.classList.toggle("input-error",!1)}),400);break}const a=s(n);t.style.display="none",e.innerHTML="✔ installed",e.parentElement.classList.toggle("installed",!0);const o=e.parentElement.parentElement,r={name:o.querySelector(".pkg-title").innerHTML,version:i,description:o.querySelector(".pkg-desc").innerHTML};a.installed.push(r),a.dispatchEvent(l({list:a.installed,item:r,action:"add"}));break}case"cancel":{const e=n.parentElement.previousElementSibling;n.parentElement.innerHTML="install",e.style.display="none";break}}}class p extends HTMLElement{constructor(){super(),this.activeMenu="Installed",this.installed=[],this.keywordFileter=i(d);const t=this.attachShadow({mode:"open"}),n=this.ownerDocument.createElement("div");n.style.width="inherit",n.style.height="inherit",n.innerHTML=e,t.appendChild(n)}async installPackage(e){for(const n in e){const s=e[n],i=await t(n);this.installed.push({version:s,name:n,description:i.description})}}connectedCallback(){const{entry:e,menu:t,keywordInput:n,resultContent:s,iconClose:i}=this;e.addEventListener("click",o),t.addEventListener("click",r),n.addEventListener("input",this.keywordFileter),s.addEventListener("click",u),i.addEventListener("click",o)}disconnectedCallback(){}get entry(){return this.shadowRoot.querySelector("#entry")}get panel(){return this.shadowRoot.querySelector("#panel")}get menu(){return this.shadowRoot.querySelector("ul.menu")}get resultContent(){return this.shadowRoot.querySelector(".result .content")}get keywordInput(){return this.shadowRoot.querySelector(".result .filter")}get iconClose(){return this.shadowRoot.querySelector(".icon-close")}}function m(){window.customElements.get("unpkg-manage")||(a(),window.UnpkgManage=p,window.customElements.define("unpkg-manage",p))}export{m as i};
